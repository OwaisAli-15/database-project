{% extends 'Book.html' %}

{% block navbar%}
{% if type == "Set As Admin"%}
<li class="u-nav-item"><a
        class="u-button-style u-nav-link u-text-active-palette-3-dark-1 u-text-hover-palette-3-dark-1 u-text-palette-3-dark-1"
        href="/room" style="padding: 10px 0px;">Room</a>
</li>
<li class="u-nav-item"><a
        class="u-button-style u-nav-link u-text-active-palette-3-dark-1 u-text-hover-palette-3-dark-1 u-text-palette-3-dark-1"
        href="/roomtype" style="padding: 10px 0px;">Room Type</a>
</li>
<li class="u-nav-item"><a
        class="u-button-style u-nav-link u-text-active-palette-3-dark-1 u-text-hover-palette-3-dark-1 u-text-palette-3-dark-1"
        href="/externalservice" style="padding: 10px 0px;">External Service</a>
</li>
<li class="u-nav-item"><a
        class="u-button-style u-nav-link u-text-active-palette-3-dark-1 u-text-hover-palette-3-dark-1 u-text-palette-3-dark-1"
        href="/servicecharges" style="padding: 10px 0px;">Service Charges</a>
</li>
<li class="u-nav-item"><a
        class="u-button-style u-nav-link u-text-active-palette-3-dark-1 u-text-hover-palette-3-dark-1 u-text-palette-3-dark-1"
        href="/servicehistory" style="padding: 10px 0px;">Service History</a>
</li>
<li class="u-nav-item"><a
        class="u-button-style u-nav-link u-text-active-palette-3-dark-1 u-text-hover-palette-3-dark-1 u-text-palette-3-dark-1"
        href="/pendings" style="padding: 10px 0px;">Pending</a>
</li>
<li class="u-nav-item"><a
        class="u-button-style u-nav-link u-text-active-palette-3-dark-1 u-text-hover-palette-3-dark-1 u-text-palette-3-dark-1"
        href="/bill" style="padding: 10px 0px;">Billing</a>
</li>
{% endif%}
{% endblock %}

{% block main %}
<section class="u-clearfix u-section-1" id="sec-6d0d">
    <div class="u-clearfix u-image u-sheet u-image-1" data-image-width="1280" data-image-height="853">
        <div class="u-shape u-shape-rectangle u-white u-shape-1"></div>
        <h2 class="u-text u-text-default u-text-1">Book Room</h2>
        <div class="u-form u-form-1">
            <form action="/reservation" method="POST"
                  class="u-clearfix u-form-custom-backend u-form-spacing-10 u-form-vertical u-inner-form"
                  style="padding: 10px" source="custom" name="form" redirect="true">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckChecked" onchange='fillid()'>
                    <label class="form-check-label" for="flexCheckChecked">
                        Reserve for Self
                    </label>
                </div>
                <div class="u-form-group u-form-name">
                    <label for="name-3b9a" class="u-form-control-hidden u-label">Name</label>
                    <input type="text" placeholder="Enter your CNIC" id="name-3b9a" name="name"
                           class="u-border-1 u-border-grey-30 u-input u-input-rectangle u-radius-15 u-white"
                           required="required">
                </div>

                <div class="u-form-group u-form-partition-factor-2 u-form-group-2">
                    <label for="text-0252" class="u-form-control-hidden u-label"></label>
                    <input type="text" id="text-0252" name="text"
                           class="u-border-1 u-border-grey-30 u-input u-input-rectangle u-radius-15 u-white"
                           placeholder="Reference">
                </div>
                <div class="u-form-group u-form-partition-factor-2 u-form-group-3">
                    <label for="text-af38" class="u-form-control-hidden u-label"></label>
                    <input type="text" placeholder="Purpose of Visit" id="text-af38" name="text-1"
                           class="u-border-1 u-border-grey-30 u-input u-input-rectangle u-radius-15 u-white">
                </div>
                <div class="u-form-date u-form-group u-form-partition-factor-2 u-form-group-4">
                    <label for="date-ba0f" class="u-label">Check In Date</label>
                    <input type="date" required pattern="\d{4}-\d{2}-\d{2}" placeholder="Check in Date" id="date-ba0f"
                           name="date"
                           class="u-border-1 u-border-grey-30 u-input u-input-rectangle u-radius-15 u-white"
                           required="required">
                </div>
                <div class="u-form-date u-form-group u-form-partition-factor-2 u-form-group-5">
                    <label for="date-65d1" class="u-label">Check Out Date</label>
                    <input type="date" required pattern="\d{4}-\d{2}-\d{2}" placeholder="Check out Date" id="date-65d1"
                           name="date-1"
                           class="u-border-1 u-border-grey-30 u-input u-input-rectangle u-radius-15 u-white"
                           required="required">
                </div>
                <div class="u-form-group u-form-select u-form-group-6">
                    <label for="select-03a1" class="u-form-control-hidden u-label"></label>
                    <div class="u-form-select-wrapper">
                        <select onclick=" getRooms()" id="select-03a1" name="select"
                                class="u-border-1 u-border-grey-30 u-input u-input-rectangle u-radius-15 u-white"
                                required="required">
                            <option id="choosing" value="Choose Between Available Rooms">Choose Between Available
                                Rooms
                            </option>
                            <option value="Item 2">Unable to Fetch Data</option>
                        </select>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="12" version="1" class="u-caret">
                            <path fill="currentColor" d="M4 8L0 4h8z"></path>
                        </svg>
                    </div>
                </div>
                <div class="u-align-center u-form-group u-form-submit">
                    <a href="#" class="u-btn u-btn-round u-btn-submit u-button-style u-radius-15">Submit</a>
                    <input type="submit" value="submit" class="u-form-control-hidden">
                </div>
                <div class="u-form-send-message u-form-send-success"></div>
                <div class="u-form-send-error u-form-send-message"></div>
                <input type="hidden" value="" name="recaptchaResponse">
            </form>
        </div>
    </div>
</section>


<section class="u-align-center u-clearfix u-section-2" id="sec-7b39">
    <form action="{{ url_for('addRegion') }}" method="post">
        <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
            <h1 class="u-text u-text-default u-text-1">My Bookings</h1>
            <div class="u-expanded-width u-table u-table-responsive u-table-1">
                <table class="u-table-entity u-table-entity-1">
                    <colgroup>
                        <col width="25%">
                        <col width="25%">
                        <col width="25%">
                        <col width="25%">
                    </colgroup>
                    <thead class="u-palette-4-base u-table-header u-table-header-1">
                    <tr style="height: 21px;">
                        <th class="u-border-1 u-border-palette-4-base u-table-cell u-text-palette-2-dark-3">Book By</th>
                        <th class="u-border-1 u-border-palette-4-base u-table-cell u-text-palette-2-dark-3">Booked For
                        </th>
                        <th class="u-border-1 u-border-palette-4-base u-table-cell u-text-palette-2-dark-3">Room
                            Number
                        </th>
                        <th class="u-border-1 u-border-palette-4-base u-table-cell u-text-palette-2-dark-3">Check in
                        </th>
                        <th class="u-border-1 u-border-palette-4-base u-table-cell u-text-palette-2-dark-3">Check Out
                        </th>
                        <th class="u-border-1 u-border-palette-4-base u-table-cell u-text-palette-2-dark-3">Status</th>
                        <th class="u-border-1 u-border-palette-4-base u-table-cell u-text-palette-1-dark-3">Options</th>
                    </tr>
                    </thead>
                    <tbody class="u-table-body">
                    {% for onebooking in allbookings %}
                    <tr style="height: 75px;">

                        <td class="u-border-1 u-border-grey-30 u-first-column u-grey-5 u-table-cell u-table-cell-5">{{
                            onebooking[0] }}
                        </td>
                        <td class="u-border-1 u-border-grey-30 u-table-cell">{{ onebooking[5] }}</td>
                        <td class="u-border-1 u-border-grey-30 u-table-cell">{{ onebooking[6] }}</td>
                        <td class="u-border-1 u-border-grey-30 u-table-cell">{{ onebooking[1] }}</td>
                        <td class="u-border-1 u-border-grey-30 u-table-cell">{{ onebooking[2] }}</td>
                        <td class="u-border-1 u-border-grey-30 u-table-cell">{{ onebooking[4] }}</td>
                        <td class="u-border-1 u-border-grey-30 u-table-cell u-table-cell-12">
                            <!--                            <a href="#" class="u-btn u-btn-round u-btn-submit u-button-style u-radius-15">-->
                            <!--                                Cancel - {{ onebooking[3] }}</a>-->
                            <!--                            <input type="submit" value="{{ onebooking[3] }}" class="u-form-control-hidden"></td>-->
                            <input name="{{onebooking[3]}}" type="submit" value="Cancel" class="btn btn-primary">
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <br>
                <br>
                <br>
            </div>
        </div>
    </form>
</section>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
        integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
        integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
        crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>



{% endblock %}

{% block script %}

var today = new Date();
var dd = today.getDate();
var mm = today.getMonth() + 1; //January is 0!
var yyyy = today.getFullYear();

if (dd < 10) {
   dd = '0' + dd;
}

if (mm < 10) {
   mm = '0' + mm;
}

today = yyyy + '-' + mm + '-' + dd;
document.getElementById("date-ba0f").setAttribute("min", today);
document.getElementById("date-65d1").setAttribute("min", today);


// Connect to websocket
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

var preIndate;
var preOutdate;

 var InDate = document.getElementById("date-65d1").value ;
        var outDate = document.getElementById("date-ba0f").value;

 var refresh;
var checkbox = document.getElementById("flexCheckChecked");

function fillid(){
 var list =  {{ id }};
    var id = list[5];

    if(checkbox.checked == true){
        document.getElementById("name-3b9a").value = list;
    }else{
        document.getElementById("name-3b9a").value  = "";
   }

 }

function getRooms(){
         InDate = document.getElementById("date-ba0f").value  ;
         outDate = document.getElementById("date-65d1").value  ;

        if (InDate == "" || outDate == ""){
            alert("Set up the dates first");
         } else {


        var indo =InDate.split('-');
        var out =outDate.split('-');
        // Please pay attention to the month (parts[1]); JavaScript counts months from 0:
        // January - 0, February - 1, etc.
        var inD = new Date(indo[0], indo[1] - 1, indo[2]);
        var outD = new Date(out[0], out[1] - 1, out[2]);
        console.log("inD: " + inD.toDateString());
        console.log("outD: " + outD.toDateString());

        socket.emit('message', {'checkin': InDate, 'checkOut' : outDate} );

        socket.on('gotrooms', data => {
            console.log(JSON.stringify(data["rooms"]));

            select = document.getElementById('select-03a1');


            if (InDate != preIndate || outDate != preOutdate ){

            preIndate = InDate;
            preOutdate = outDate;

             console.log(preIndate + " -> " + InDate );
            console.log(preOutdate + " -> " + outDate );
            console.log(InDate != preIndate || outDate != preOutdate);

            refresh = true;

            }

            else {

            refresh = false;

            }


            if (refresh){
            function removeOptions(selectElement) {
               var i, L = selectElement.options.length - 1;
               for(i = L; i >= 0; i--) {
                  selectElement.remove(i);
               }
            }

            removeOptions(select);

             var opt = document.createElement('option');
             opt.value = "Select a room";
             opt.innerHTML = "Select a room";
             opt.disabled = true;
             select.appendChild(opt);

            for (var i = 0; i < data["rooms"].length; i++)
            {
                var opt = document.createElement('option');
                opt.value = data["rooms"][i][1];
                opt.innerHTML = data["rooms"][i][0];
                console.log(data["rooms"][1]);
                select.appendChild(opt);
            }
            }





        });


        }
    }



{% endblock %}